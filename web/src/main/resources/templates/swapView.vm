#set($confirmed = $rotaView.approvedVolunteer.isPresent())

#set($offererIsYou = ($offer.offer.swapFrom.worker.username == $sec.loggedInUser().get().getUsername()))
#if($offererIsYou)
	#set($offerer = "You")
	#set($offererClass = "you")
#else
	#set($offerer = $offer.offer.swapFrom.worker.username)
	#set($offererClass = "them")
#end

<h1>$display.fullDate($offer.offer.swapFrom.shift.date)</h1>
<ol class="events">

	#if ($confirmed)
		#set($volunteerText = "is volunteering")
	#else
		#set($volunteerText = "volunteered")
	#end

	#foreach($volunteer in $offer.volunteers)
		#set($volunteerIsYou = ($volunteer.swapFrom.worker.username == $sec.loggedInUser().get().getUsername()))

		#if($volunteerIsYou)
			#set($volunteerName = "You")
			#set($yourRota = $volunteer.swapFrom)
			#set($theirRota = $offer.offer.swapFrom)
			#set($volunteerClass = "you")
		#else
			#set($yourRota = $offer.offer.swapFrom)
			#set($theirRota = $volunteer.swapFrom)
			#set($volunteerName = $theirRota.worker.username)
			#set($volunteerClass = "them")
		#end

		#set($otherRota = $volunteer.swapTo.swapFrom)


		#if (!$confirmed)
        <li class="event event--confirmed">
            <strong>Swap agreed.</strong> Waiting for HR to authorise.
            <div class="event__swap event__swap-agreed">
                <div class="event__rota event__rota-you">
                    <div class="event__rota-person">You</div>
                    <div class="event__rota-shift">Z1T</div>
                    <time class="event__rota-date" datetime="2014-10-15">Wed, 15 Oct</time>
                </div>
                <div class="event__rota event__rota-them">
                    <div class="event__rota-person">You</div>
                    <div class="event__rota-shift">Z1T</div>
                    <time class="event__rota-date" datetime="2014-10-15">Wed, 15 Oct</time>
                </div>
            </div>
        </li>
		#end
      <li class="event event--$volunteerClass">
          <strong>$volunteerName</strong> $volunteerText to swap
          <div class="event__swap">
              <div class="event__rota event__rota-you">
                  <div class="event__rota-person">You</div>
                  <div class="event__rota-shift">$yourRota.shift.type</div>
                  <time class="event__rota-date" datetime="2014-10-15">$display.fullDate($yourRota.shift.date)</time>
              </div>
              <div class="event__rota event__rota-them">
                  <div class="event__rota-person">$theirRota.worker.username</div>
                  <div class="event__rota-shift">$theirRota.shift.type</div>
                  <time class="event__rota-date" datetime="2014-10-15">$display.fullDate($theirRota.shift.date)</time>
              </div>
          </div>
				#if (!$volunteerIsYou)
            <div class="event__actions">
                <form action="">
                    <div class="event__action">
                        <button class="submit-button" type="submit">Accept offer</button>
                    </div>
                </form>
                <form action="">
                    <div class="event__action">
                        <button class="submit-button-secondary" type="submit">No thanks</button>
                    </div>
                </form>
            </div>
				#end
      </li>
	#end

    <li class="event event--offer event--$offererClass">
			$offerer offered to swap $offer.offer.swapFrom.shift.type.label $offer.offer.swapFrom.shift.type
        on $offer.offer.swapFrom.shift.date
        for $offer.offer.swapTo.type.label $offer.offer.swapTo.type on $offer.offer.swapTo.date
    </li>


</ol>