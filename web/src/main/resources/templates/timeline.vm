#* @vtlvariable name="rotasByMonth" type="java.util.Map<java.time.Month, java.util.List<uk.gov.homeofficedigital.swappr.controllers.views.RotaView>>" *#
#set($pageTitle = 'Timeline')
#set($tab = 'timeline')

#foreach($rotaMonth in $rotasByMonth.keySet())
	#set($rotaViews = $rotasByMonth.get($rotaMonth))

<div class="timeline__heading-container">
    <h1 class="timeline__heading"><span class="secondary-text">All / </span>$display.month($rotaMonth)</h1>
</div>
	#if($rotaViews.isEmpty())
  <p>No swaps</p>
	#else
  <ol class="timeline__days">


		#foreach($rotaView in $rotaViews)
			#foreach($offer in $rotaView.getOffers())
				#if ($rotaView.rota.shift.date == $lastDate)
					#set($hiddenClass = " hidden")
				#else
					#set($hiddenClass = "")
				#end
      <li class="t-day timeline__day" data-t-date="$display.isoDate($rotaView.rota.shift.date)">
              <div class="timeline__day-info timeline__day-info-date"><span class="$hiddenClass"><span class="timeline__date-day">$rotaView.rota.shift.date.dayOfMonth</span> <span
                      class="secondary-text">${display.day($rotaView.rota.shift.date)}</span></span></div>
              <div class="timeline__day-info timeline__day-info-shift">
								#if($offer.offerForCurrentUser)
                    <strong>You</strong> want
								#else
                    <strong>$offer.offer.swapFrom.worker.fullname</strong> wants
								#end
                  to swap $offer.offer.swapFrom.shift.type.label <span class="timeline__shift-type">$offer.offer.swapFrom.shift.type</span> <span class="icon-arrow-right">for</span> $offer.offer.swapTo.type.label <span class="timeline__shift-type">$offer.offer.swapTo.type</span>
								#if(!$offer.sameDaySwap)
                    on $display.fullDate($offer.offer.swapTo.date)
								#end
							</div>

              <div class="timeline__day-info timeline__day-info-action">
								#if($offer.offer.status.name() == 'APPROVED')
                    <span class="action-button action-button--disabled action-button--swapped"
                          title="Shift swapped">Shift swapped</span>
								#else
                    <form action="/swap/$offer.id/volunteer" method="post">
                        <button class="t-button-volunteer action-button action-button--swap" type="submit" title="Volunteer to swap">Volunteer</button>
                    </form>
								#end
              </div>
              <div class="secondary-text timeline__day-info timeline__day-info-status">
								#if ($offer.offer.status.name() != 'APPROVED')
									#if($offer.offerForCurrentUser)
                      You've <a href="/swap/$offer.id">offered to swap</a>
									#end
								#end
              </div>
          </li>

				#set($lastDate = $rotaView.rota.shift.date)
			#end
		#end
  </ol>
	#end
#end